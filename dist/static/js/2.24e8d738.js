(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{205:function(t,e,a){},206:function(t,e,a){},229:function(t,e,a){"use strict";var o=a(205);a.n(o).a},230:function(t,e,a){"use strict";var o=a(206);a.n(o).a},89:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"goods-info"}},[a("header",[t._v(t._s("create"===this.$route.params.type?"新建":"编辑")+"商品信息\n    "),a("com-back")],1),t._v(" "),a("el-form",{ref:"goodsData",staticClass:"demo-ruleForm",attrs:{model:t.goodsData,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"商品名称：",prop:"name"}},[a("el-input",{staticClass:"slot_inp_b",attrs:{placeholder:"请输入商品名称（不少于3个字）"},model:{value:t.goodsData.name,callback:function(e){t.$set(t.goodsData,"name",e)},expression:"goodsData.name"}},[a("template",{staticClass:"slot",slot:"append"},[t.goodsData.name.gbLength()>0?a("span",{staticStyle:{color:"#4b5afe"},domProps:{textContent:t._s(t.goodsData.name.gbLength())}}):t._e(),0==t.goodsData.name.gbLength()?a("span",{staticStyle:{color:"#999"},domProps:{textContent:t._s(t.goodsData.name.gbLength())}}):t._e(),t._v("/20")])],2)],1),t._v(" "),a("el-form-item",{staticClass:"is-required",attrs:{label:"原始价格：",prop:"price"}},[a("div",{staticClass:"a_unit"},[a("el-input",{attrs:{min:"0",max:"999999",placeholder:"请输入价格"},model:{value:t.goodsData.price,callback:function(e){t.$set(t.goodsData,"price",t._n(e))},expression:"goodsData.price"}}),t._v(" "),a("span",[t._v("元")])],1)]),t._v(" "),a("el-form-item",{attrs:{label:"优惠价格：",prop:"disprice"}},[a("div",{staticClass:"a_unit"},[a("el-input",{attrs:{disabled:!t.goodsData.price,placeholder:"请输入价格"},model:{value:t.goodsData.preferential,callback:function(e){t.$set(t.goodsData,"preferential",t._n(e))},expression:"goodsData.preferential"}}),t._v(" "),a("span",[t._v("元")])],1)]),t._v(" "),a("el-form-item",{staticClass:"image-list",staticStyle:{"margin-bottom":"15px"},attrs:{label:"商品图片：",prop:"imgUrl"}},[a("div",{staticClass:"upload_box"},[a("div",{staticStyle:{display:"inline-block"}},[a("ve-upload",{attrs:{title:"图片支持jpg、png、bmp&nbsp;&nbsp;不超过2MB <br> 最佳尺寸：600 x 800",accept:"png|jpg|jpeg|bmp|gif",defaultImg:t.defaultImg,fileSize:2048,initImg:t.goodsData.imgUrl},on:{error:t.uploadError,success:t.uploadImgSuccess}}),t._v(" "),t.imgEmptyMsg?a("span",{staticClass:"error-msg img-error error12"},[t._v(t._s(t.imgEmptyMsg))]):t._e()],1)])]),t._v(" "),a("el-form-item",{staticClass:"is-required",attrs:{label:"现有库存：",prop:"inventory"}},[a("div",{staticClass:"a_unit"},[a("el-input",{attrs:{min:"0",max:"999999",placeholder:"请输库存"},model:{value:t.goodsData.inventory,callback:function(e){t.$set(t.goodsData,"inventory",t._n(e))},expression:"goodsData.inventory"}}),t._v(" "),a("span",[t._v("件")])],1)]),t._v(" "),a("el-form-item",{attrs:{label:"商品描述："}},[a("com-input",{staticClass:"inupt_textarea",attrs:{"max-length":140,type:"textarea",placeholder:"请输入商品描述"},model:{value:t.goodsData.describe,callback:function(e){t.$set(t.goodsData,"describe","string"==typeof e?e.trim():e)},expression:"goodsData.describe"}})],1),t._v(" "),a("el-form-item",{staticClass:"is-required",attrs:{label:"是否上架：",prop:"inventory"}},[a("div",{},[a("el-radio",{class:[0!==t.goodsData.added],attrs:{label:"1"},model:{value:t.goodsData.added,callback:function(e){t.$set(t.goodsData,"added",e)},expression:"goodsData.added"}},[t._v("上架")]),t._v(" "),a("el-radio",{attrs:{label:"0"},model:{value:t.goodsData.added,callback:function(e){t.$set(t.goodsData,"added",e)},expression:"goodsData.added"}},[t._v("下架")])],1)]),t._v(" "),a("el-form-item",{staticClass:"btns_box"},[a("el-button",{staticClass:"add-goods primary-button",attrs:{type:"primary",round:""},on:{click:function(e){t.onSubmit("goodsData")}}},[t._v("保存")]),t._v(" "),a("el-button",{attrs:{round:""},on:{click:function(e){t.resetForm("goodsData")}}},[t._v("取消")])],1)],1)],1)};o._withStripped=!0;var r=a(213),i=a(201),s=a(59),n={name:"info",watch:{goodsData:{handler:function(){this.initReady&&(this.isShowMsgB=!0)},deep:!0}},created:function(){var t=this;"update"===this.$route.params.type?(this.getGoodsDetail(),this.Breadcrumb="编辑商品"):this.Breadcrumb="新建商品",this.$nextTick(function(){t.initReady=!0})},mounted:function(){s.a.$emit("breads",[{title:"商品管理"},{title:"商品列表",url:"/goodMager/list"},{title:this.Breadcrumb,url:"/goodMager/edit/"+this.$route.params.type}])},components:{VeUpload:r.a},computed:{defaultImg:function(){return this.poster?this.$imgHost+"/"+this.poster:""}},data:function(){var t=this;return{timerVail:null,timer:null,tipsShow:!0,Breadcrumb:"",isShowMsgB:!1,errTitle:"",imgEmptyMsg:"",goodId:this.$route.params.id,goodsData:{name:"",price:"",disprice:"",describe:"",inventory:null,added:"1",imgUrl:""},rules:{name:[{required:!0,validator:function(e,a,o){console.log(a),t.timerVail||(t.timerVail=setTimeout(function(){if(clearTimeout(t.timerVail),t.timerVail=null,!a)return o(new Error("商品名称不能为空"));if(a.gbLength()<e.min)return o(new Error("商品名称过短"));if(a.gbLength()>e.max){for(var r in t[e.obj])if(r===e.field)return t[e.obj][r]=a.slice(0,a.gbIndex(e.max)+1),o()}else o()},500))},min:3,max:20,trigger:"change",obj:"goodsData"}],price:[{validator:function(t,e,a){return"number"!=typeof e||!e&&0!==e?a(new Error("请输入原始价格")):e<0||e>=999999?a(new Error("原始价格应大于0小于999999")):String(e).indexOf(".")>-1&&String(e).slice(String(e).indexOf(".")+1).length>2?a(new Error("价格最多为小数点后两位")):a()},type:"number",min:0,max:999999,trigger:"change",obj:"goodsData"}],preferential:[{validator:function(e,a,o){if(a){if("number"==typeof a){var r=t[e.obj].price;return a&&a<0?o(new Error("优惠价格不能小于0")):a&&r&&a>=r?o(new Error("优惠价格需小于原始价格")):String(a).indexOf(".")>-1&&String(a).slice(String(a).indexOf(".")+1).length>2?o(new Error("优惠价格最多为小数点后两位")):a&&!r?o(new Error("请先填写原始价格")):o()}return o(new Error("请输入优惠价格"))}return o()},type:"number",min:0,max:999999,trigger:"change",obj:"goodsData"}],inventory:[{validator:function(t,e,a){return"number"!=typeof e||!e&&0!==e?a(new Error("请输入现有库存")):e<0||e>=999999?a(new Error("现有库存应大于0小于999999")):String(e).indexOf(".")>-1&&String(e).slice(String(e).indexOf(".")+1).length>=1?a(new Error("库存量应为整数")):a()},type:"number",min:0,max:999999,trigger:"change",obj:"goodsData"}],imgUrl:[{required:!0,validator:function(e,a,o){return a?o():(t.imgEmptyMsg="请上传图",o(new Error("请上传图")))},trigger:"blur",obj:"goodsData"}]}}},methods:{getGoodsDetail:function(){var t=this,e={goodId:this.goodId};this.$get(i.a.GET_GOOD_BYID,e).then(function(e){200===e.code&&(t.goodsData=e.data)}),console.log(this.goodId)},onSubmit:function(t){var e=this;this.timer||(this.timer=setTimeout(function(){clearTimeout(e.timer),e.timer=null,e.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;var a=void 0;"create"===e.$route.params.type?a=i.a.CREATE_GOODS:(e.goodsData.goods_id=e.$route.params.id,a=i.a.UPDATE_GOODS),e.$post(a,e.goodsData).then(function(t){e.$router.go(-1),e.isShowMsgB=!1}).catch(function(t){console.log(t)})})},100))},resetForm:function(t){this.$router.go(-1)},uploadImgSuccess:function(t){t.errMsg="",this.goodsData.imgUrl=t.name},uploadError:function(t,e,a){this.imgEmptyMsg="",e.errMsg=t.msg}},beforeRouteLeave:function(t,e,a){this.isShowMsgB?this.$messageBox({header:"提示",width:"400px",content:"是否放弃当前编辑？",cancelText:"否",confirmText:"是",handleClick:function(t){"confirm"===t.action?a(!0):a(!1)}}):a(!0)}},l=(a(229),a(230),a(0)),d=Object(l.a)(n,o,[],!1,null,"2fc6d335",null);d.options.__file="src/pages/good-mager/edit.vue";e.default=d.exports}}]);
//# sourceMappingURL=2.24e8d738.js.map