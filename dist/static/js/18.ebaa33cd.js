(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{505:function(t,e,i){"use strict";i.r(e);var s=i(95),a=i.n(s),n=i(131),l=i.n(n),o=i(27),c=i.n(o),r=i(517),u=i(514),m=i(93),d=i(15),v=i(708),f=i(59),_={DRAFT:"草稿",SEND:"已发送",AWAIT:"等待发送"},h={name:"info",data:function(){return{email:{activityId:0,emailInviteId:0,title:"",content:"",desc:"",planTime:"",sendTime:"",senderName:"",sendCount:0,status:"",statusName:""},selectedGroupList:[],selectedTagList:[],groupList:[],tagList:[],sendDetail:!1}},components:{comDetail:v.a},computed:Object(m.c)("liveMager",{emailInfo:function(t){return t.emailInfo}}),watch:{emailInfo:{handler:function(t){this.email=c()({},t)},immediate:!0}},created:function(){this.$route.params.id?(this.email.emailInviteId=this.$route.query.email,this.queryTagList().then(this.queryGroupList()).then(this.queryEmailInfo())):this.$router.go(-1)},mounted:function(){f.a.$emit("breads",[{title:"活动管理"},{title:"活动列表",url:"/liveMager/list"},{title:"活动详情",url:"/liveMager/detail/"+this.$route.params.id},{title:"邮件邀约",url:"/liveMager/email/"+this.$route.params.id},{title:"预览"}])},methods:c()({},Object(m.b)("liveMager",{storeEmailInfo:d.d}),{queryEmailInfo:function(){var t=this;this.email.emailInviteId&&this.$get(u.a.GET_EMAIL_INFO,{emailInviteId:this.email.emailInviteId}).then(function(e){e.data.statusName=_[e.data.status],t.email=e.data,setTimeout(function(){t.reArrangeList(e.data.groupIds?e.data.groupIds.split(","):[],e.data.tagIds?e.data.tagIds.split(","):[])},500),t.storeEmailInfo(t.email)})},sendEmail:function(){var t=this;this.checkEmail()?this.$messageBox({header:"提示",content:"是否立即发送此邮件？",confirmText:"确定",cancelText:"取消",handleClick:function(e){"confirm"===e.action&&t.$post(u.a.POST_SEND_EMAIL_INFO,{emailInviteId:t.email.emailInviteId}).then(function(){console.log("邮件发送成功"),t.$router.push("/liveMager/email/"+t.$route.params.id)})}}):this.$messageBox({header:"提示",content:"邮件未编辑完成，无法发送邮件！",confirmText:"立即编辑",cancelText:"取消",handleClick:function(e){"confirm"===e.action&&t.editEmail()}})},checkEmail:function(){return!!this.email.content&&(!(!this.email.groupIds&&!this.email.tagIds)&&(!!this.email.senderName&&!("AWAIT"===this.email.status&&!this.email.planTime)))},editEmail:function(){this.$router.push("/liveMager/emailEditOne/"+this.email.activityId+"?email="+this.email.emailInviteId)},prePage:function(){this.$router.go(-1)},queryGroupList:function(t){var e=this;return l()(a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$get(r.a.GET_GROUP_LIST).then(function(t){var i=[];t.data.list.forEach(function(t){i.push({id:t.group_id,name:t.title,count:t.user_count,isChecked:!1})}),e.groupList=i});case 2:case"end":return t.stop()}},t,e)}))()},queryTagList:function(){var t=this;return l()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$get(r.a.GET_TAG_LIST).then(function(e){var i=[];e.data.list.forEach(function(t){i.push({name:t.tag_name,id:t.tag_id,count:t.user_count,isChecked:!1})}),t.tagList=i});case 2:case"end":return e.stop()}},e,t)}))()},reArrangeList:function(t,e){var i=this;this.email.expectNum=0,this.groupList.forEach(function(e,s){t.forEach(function(t,s){1*t==1*e.id&&(i.email.expectNum=i.email.expectNum+parseInt(e.count),i.selectedGroupList.push({count:e.count,id:e.id,isChecked:!0,name:e.name}))})}),this.tagList.forEach(function(t,s){e.forEach(function(e,s){1*e==1*t.id&&(i.email.expectNum=i.email.expectNum+parseInt(t.count),i.selectedTagList.push({count:t.count,id:t.id,isChecked:!0,name:t.name}))})}),console.log(this.selectedGroupList),console.log(this.selectedTagList)},handleClick:function(t){"cancel"===t.action&&(this.sendDetail=!1)}})},p=(i(778),i(779),i(1)),g=Object(p.a)(h,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"live-mager edit-step-box"},[i("div",{staticClass:"live-title"},[i("span",{staticClass:"title"},[t._v("查看邮件")]),t._v(" "),i("com-back",{class:"back-btn"})],1),t._v(" "),i("div",{staticClass:"tip-box"},[t._v("\n    通过邮件邀约，定制邀约邮件，邀请特定客户群参加直播活动\n  ")]),t._v(" "),i("div",{staticClass:"mager-box border-box"},[i("div",{staticClass:"from-box"},[i("div",{staticClass:"from-row"},[i("div",{staticClass:"from-title"},[t._v("邮件标题：")]),t._v(" "),i("div",{staticClass:"from-content"},[t._v(t._s(t.email.title))])]),t._v(" "),i("div",{staticClass:"from-row"},[i("div",{staticClass:"from-title"},[t._v("发件人：")]),t._v(" "),i("div",{staticClass:"from-content"},[t._v(t._s(t._f("isEmpty")(t.email.senderName,"-")))])]),t._v(" "),i("div",{staticClass:"from-row"},[i("div",{staticClass:"from-title"},[t._v("收件人：")]),t._v(" "),i("div",{class:{"from-content":!0,receiver:!0,"send-detail":"SEND"==t.email.status}},[t.selectedGroupList.length||t.selectedTagList.length?[t.selectedGroupList.length?i("div",{staticClass:"receiver-item"},t._l(t.selectedGroupList,function(e,s){return i("span",[t._v(t._s(e.name)),s+1<t.selectedGroupList.length?[t._v("、")]:t._e()],2)})):t._e(),t._v(" "),t.selectedTagList.length?i("div",{staticClass:"receiver-item"},[t._l(t.selectedTagList,function(e,s){return i("span",[t._v(t._s(e.name)),s+1<t.selectedTagList.length?[t._v("、")]:t._e()],2)}),t._v("（合计"+t._s(t.email.expectNum)+"人）\n            ")],2):t._e(),t._v(" "),"SEND"==t.email.status?i("el-button",{staticClass:"send-detail default-button",on:{click:function(e){t.sendDetail=!0}}},[t._v("发送详情")]):t._e()]:[t._v("\n            暂未选择\n          ")]],2)]),t._v(" "),i("div",{staticClass:"from-row"},[i("div",{staticClass:"from-title"},[t._v("发件状态：")]),t._v(" "),i("div",{staticClass:"from-content"},["DRAFT"==t.email.status?i("span",{staticClass:"cg-status"},[i("i",{staticClass:"iconfont icon-shijian"}),t._v(t._s(t.email.statusName))]):t._e(),t._v(" "),"SEND"==t.email.status?i("span",{staticClass:"fs-status"},[i("i",{staticClass:"iconfont icon-shijian"}),t._v(t._s(t.email.statusName))]):t._e(),t._v(" "),"AWAIT"==t.email.status?i("span",{staticClass:"dd-status"},[i("i",{staticClass:"iconfont icon-shijian"}),t._v(t._s(t.email.statusName))]):t._e()])]),t._v(" "),i("div",{staticClass:"from-row"},[i("div",{staticClass:"from-title"},[t._v("发件时间：")]),t._v(" "),i("div",{staticClass:"from-content"},[t._v(t._s(t._f("isEmpty")(t.email.sendTime,"-")))])]),t._v(" "),i("div",{staticClass:"from-row"},[i("div",{staticClass:"email-info-box",domProps:{innerHTML:t._s(t.email.content)}})]),t._v(" "),"SEND"!==t.email.status?i("div",{staticClass:"step-btns"},[i("button",{staticClass:"default-button margin-fl",on:{click:t.editEmail}},[t._v("编辑邮件")]),t._v(" "),i("button",{staticClass:"primary-button",on:{click:t.sendEmail}},[t._v("立即发送")])]):t._e()])]),t._v(" "),t.sendDetail?i("transition",{attrs:{name:"fade",mode:"out-in"}},[i("com-detail",{attrs:{_type:"EMAIL"},on:{handleClick:t.handleClick}})],1):t._e()],1)},[],!1,null,"7728692a",null);g.options.__file="info.vue";e.default=g.exports},592:function(t,e,i){},593:function(t,e,i){},778:function(t,e,i){"use strict";var s=i(592);i.n(s).a},779:function(t,e,i){"use strict";var s=i(593);i.n(s).a}}]);