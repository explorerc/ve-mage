(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{484:function(t,e,a){"use strict";a.r(e);var s=a(99),n=a.n(s),i=a(138),o=a.n(i),c=a(30),r=a.n(c),l="/user/bill/list",u="/user/bill/overview",d="/user/bill/download",p="/user/business-recharge/create-bill",h="/user/business-recharge/get-payment",m="/manage/channel/create-channel-token",v=a(530),y=a(97),f=a(623),b=a(626),_={name:"asset-list",components:{VePagination:v.a},data:function(){return{total:0,liuTypeList:[{value:"",label:"全部"},{value:"RECHARGE",label:"账户充值"},{value:"RED_PACK",label:"红包消费"},{value:"RE_RED_PACK",label:"红包返回"}],viewerList:[],billInfo:{balance:0,serviceStartTime:"",serviceExpireTime:"",serviceName:"",payToday:""},searchParams:{type:"",date:"",page:1,pageSize:25},searchLabel:"",currentPage:1,addMoneyShow:!1,payMoneyShow:!1,successMoneyShow:!1,amount:"",oldAmount:"",modifyMoneyShow:!0,payway:"支付宝",payType:"ALIPAY",amountError:"",billNo:"",codeSrc:"",alDisabled:!1,wxDisabled:!1,dialogTitle:"充值",iscurrentPage:!0}},filters:{fmtStatus:function(t){return"SUCCESS"===t?"成功":"失败"},fmtType:function(t){return{RECHARGE:"账户充值",RED_PACK:"红包消费",RE_RED_PACK:"红包返回"}[t]}},computed:r()({},Object(y.c)("login",{accountInfo:function(t){return t.accountInfo}})),created:function(){this.queryAccountInfo(),this.queryList()},methods:{changePage:function(t){this.searchParams.page=t,this.queryList()},queryAccountInfo:function(){var t=this;this.$get(u,{}).then(function(e){200===e.code&&(t.billInfo=e.data)})},queryList:function(){var t=this;this.$nextTick(function(){t.$get(l,r()({},t.searchParams)).then(function(e){200===e.code&&(t.total=e.data.total,t.viewerList=e.data.list)})})},queryListType:function(){this.searchParams.page=1,this.currentPage=1,this.queryList()},exportTable:function(){var t="?type="+this.searchParams.type+"&date="+this.searchParams.date,e="/api"+d+t;window.open(encodeURI(encodeURI(e)))},addMoney:function(){this.addMoneyShow=!0},payMoney:function(t){var e=this;return o()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("confirm"!==t.action){a.next=12;break}if(e.amount){a.next=4;break}return e.amountError="请输入10～20000之间的数字",a.abrupt("return");case 4:if(!e.checkAmount()){a.next=10;break}return e.addMoneyShow=!1,e.oldAmount=e.amount,a.next=9,e.queryBillNo();case 9:""!==e.billNo&&(e.payMoneyShow=!0);case 10:a.next=16;break;case 12:e.addMoneyShow=!1,e.amount="",e.payType="ALIPAY",e.amountError="";case 16:case"end":return a.stop()}},a,e)}))()},modifyMoney:function(){this.modifyMoneyShow=!this.modifyMoneyShow},saveMoney:function(){this.checkAmount()&&(this.modifyMoneyShow=!0,this.amount!==this.oldAmount&&(this.queryBillNo(),this.oldAmount=this.amount))},cancelMoney:function(){this.amount=this.oldAmount,this.modifyMoneyShow=!0},checkAmount:function(){var t=this.amount;return t<10||t>2e4?(this.amountError="请输入10～20000之间的数字",!1):(this.amountError="",!0)},queryCode:function(){var t=this;return o()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$get(h,{billNo:t.billNo,payType:t.payType}).then(function(e){200===e.code&&(t.codeSrc="//aliqr.e.vhall.com/qr.png?t="+e.data.qrcode)});case 2:t.initMsgServe();case 3:case"end":return e.stop()}},e,t)}))()},initMsgServe:function(){var t=this;return o()(n.a.mark(function e(){var a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$get(m,{thirdUserId:t.accountInfo.businessUserId,channel:t.accountInfo.channelRoom}).then(function(t){return t.data});case 2:a=e.sent,f.a.OBJ.init({accountId:a.accountId,token:a.token,appId:a.appId,channelId:a.channelRoom}),f.a.OBJ.regHandler(b.a.charge,function(e){t.payMoneyShow=!1,t.successMoneyShow=!0,t.queryAccountInfo()});case 5:case"end":return e.stop()}},e,t)}))()},queryBillNo:function(){var t=this;return o()(n.a.mark(function e(){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.modifyMoneyShow||(t.amount=t.oldAmount),e.next=3,t.$get(p,{amount:t.amount}).then(function(e){if(200===e.code)return t.billNo=e.data.billNo,!0});case 3:t.queryCode();case 4:case"end":return e.stop()}},e,t)}))()},payChange:function(t){var e=this;return o()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("支付宝"!==t){a.next=9;break}return e.payType="ALIPAY",e.payway=t,e.queryCode(),e.wxDisabled=!0,a.next=7,setTimeout(function(){e.wxDisabled=!1},500);case 7:a.next=15;break;case 9:return e.payType="WXPAY",e.payway=t,e.queryCode(),e.alDisabled=!0,a.next=15,setTimeout(function(){e.alDisabled=!1},500);case 15:case"end":return a.stop()}},a,e)}))()},paidMoney:function(t){this.payMoneyShow=!1,this.amount="",this.oldAmount="",this.payType="ALIPAY",this.amountError="",this.modifyMoneyShow=!0},finishMoney:function(){this.queryAccountInfo(),this.successMoneyShow=!1,this.amount="",this.oldAmount="",this.modifyMoneyShow=!0,this.payway="支付宝",this.payType="ALIPAY"},currentPageReset:function(){var t=this;this.iscurrentPage=!1,this.$nextTick(function(){t.iscurrentPage=!0})}},watch:{"searchParams.type":{handler:function(t,e){"RECHARGE"===t?(this.searchLabel="很抱歉，没有搜索到账户充值的结果",this.currentPageReset()):"RED_PACK"===t?(this.searchLabel="很抱歉，没有搜索到红包消费的结果",this.currentPageReset()):"RE_RED_PACK"===t?(this.searchLabel="很抱歉，没有搜索到红包返回的结果",this.currentPageReset()):(this.searchLabel="暂无数据",this.currentPageReset())},deep:!0}}},g=(a(930),a(1)),C=Object(g.a)(_,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"asset-box"},[s("div",{staticClass:"asset-header"},[s("div",{staticClass:"asset-header-item"},[s("span",[t._v("所购服务")]),t._v(" "),s("span",[t._v(t._s(t.billInfo.serviceName))]),t._v(" "),s("span",[t._v("有效期 "+t._s(t.billInfo.serviceStartTime)+" ~ "+t._s(t.billInfo.serviceExpireTime))])]),t._v(" "),s("div",{staticClass:"asset-header-item"},[s("span",[t._v("可用金额（元）\n        ")]),t._v(" "),s("img",{attrs:{width:"100",height:"60",src:a(928)}}),t._v(" "),s("span",{staticClass:"mid"},[t._v(t._s(t.billInfo.balance))])]),t._v(" "),s("div",{staticClass:"asset-header-item"},[s("span",[t._v("今日支出（元）")]),t._v(" "),s("img",{attrs:{width:"100",height:"60",src:a(929)}}),t._v(" "),s("span",{staticClass:"mid-zhichu"},[t._v(t._s(t.billInfo.payToday))])])]),t._v(" "),s("div",{staticClass:"asset-list-box"},[s("div",{staticClass:"asset-list"},[s("div",{staticClass:"search-asset"},[s("span",{staticClass:"asset-title"},[t._v("账户流水")]),t._v(" "),s("button",{staticClass:"default-button export-btn fr",on:{click:t.exportTable}},[t._v("导出")]),t._v(" "),s("div",{staticClass:"search-item flm fr"},[s("span",{staticClass:"search-title"},[t._v("时间")]),t._v(" "),s("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:t.queryList},model:{value:t.searchParams.date,callback:function(e){t.$set(t.searchParams,"date",e)},expression:"searchParams.date"}})],1),t._v(" "),s("div",{staticClass:"search-item fr"},[s("span",{staticClass:"search-title"},[t._v("流水类型")]),t._v(" "),s("el-select",{ref:"search",attrs:{placeholder:"渠道来源"},on:{change:t.queryListType},model:{value:t.searchParams.type,callback:function(e){t.$set(t.searchParams,"type",e)},expression:"searchParams.type"}},t._l(t.liuTypeList,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)])]),t._v(" "),s("div",{staticClass:"asset-list-table"},[t.viewerList.length?[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.viewerList}},[s("el-table-column",{attrs:{prop:"billNumber",label:"流水ID"}}),t._v(" "),s("el-table-column",{attrs:{label:"流水类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(t._f("fmtType")(e.row.type))+"\n            ")]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"amount",label:"金额"}}),t._v(" "),s("el-table-column",{attrs:{prop:"createdAt",label:"时间"}}),t._v(" "),s("el-table-column",{attrs:{label:"状态",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{class:{status:!0,success:"SUCCESS"===e.row.status}},[t._v(t._s(t._f("fmtStatus")(e.row.status)))])]}}])})],1),t._v(" "),t.total>t.searchParams.pageSize?s("div",{staticClass:"page-pagination"},[t.iscurrentPage?s("ve-pagination",{attrs:{total:t.total,pageSize:t.searchParams.pageSize,currentPage:t.currentPage},on:{changePage:t.changePage}}):t._e()],1):t._e()]:[s("div",{staticClass:"empty"},[s("div",{staticClass:"img"}),t._v(" "),t.searchLabel?s("div",{staticClass:"txt"},[t._v(t._s(t.searchLabel))]):s("div",{staticClass:"txt"},[t._v("暂无数据")])])]],2)]),t._v(" "),s("div",{staticClass:"money-box-wrap"},[t.addMoneyShow?s("message-box",{staticClass:"add-money-msg",attrs:{width:"464px",type:"prompt",header:t.dialogTitle,confirmText:"下一步"},on:{handleClick:t.payMoney}},[s("div",{staticClass:"mager-box message-box-content"},[s("div",{staticClass:"from-box"},[s("div",{staticClass:"from-row input-box"},[s("div",{staticClass:"from-title"},[t._v("当前余额")]),t._v(" "),s("div",{staticClass:"from-content"},[s("span",{staticStyle:{"line-height":"20px"}},[t._v("¥ "+t._s(t.billInfo.balance))])])]),t._v(" "),s("div",{staticClass:"from-row input-box"},[s("div",{staticClass:"from-title"},[t._v("充值金额")]),t._v(" "),s("div",{staticClass:"from-content"},[s("div",{staticClass:"black-box"},[s("com-input",{attrs:{type:"mobile",placeholder:"10～20000",value:t.amount,errorTips:t.amountError},on:{"update:value":function(e){t.amount=e}},model:{value:t.amount,callback:function(e){t.amount=e},expression:"amount"}}),t._v(" "),s("i",{staticClass:"money-sign"},[t._v("¥")])],1)])])])])]):t._e(),t._v(" "),t.payMoneyShow?s("message-box",{staticClass:"pay-money-msg",attrs:{width:"464px",type:"prompt",header:t.dialogTitle,header:""},on:{handleClick:t.paidMoney}},[s("div",{staticClass:"mager-box message-box-content"},[s("div",{staticClass:"from-box"},[s("div",{staticClass:"from-row input-box"},[s("div",{staticClass:"from-title  modify-box"},[s("span",[t._v("充值金额")])]),t._v(" "),t.modifyMoneyShow?s("div",{staticClass:"from-content  modify-box"},[s("span",[t._v("¥ "+t._s(t.amount))]),t._v(" "),s("i",{staticClass:"modifiyMoney-btn",on:{click:t.modifyMoney}},[t._v("修改金额")])]):s("div",{staticClass:"from-content"},[s("div",{staticClass:"black-box",staticStyle:{"margin-top":"0px"}},[s("com-input",{attrs:{type:"mobile",value:t.amount,errorTips:t.amountError},on:{"update:value":function(e){t.amount=e}}}),t._v(" "),s("i",{staticClass:"pay-money-sign"},[t._v("¥")]),t._v(" "),s("span",{staticClass:"save-money",on:{click:t.saveMoney}},[t._v("保存")]),t._v(" "),s("span",{staticClass:"concel-money",on:{click:t.cancelMoney}},[t._v("取消")])],1)])]),t._v(" "),s("div",{staticClass:"from-row input-box"},[s("div",{staticClass:"from-title"},[t._v("扫码充值")]),t._v(" "),s("div",{staticClass:"from-content"},[s("div",{staticClass:"black-box"},[s("div",{staticClass:"title"},[s("button",{ref:"alipay",staticClass:"payway alipay",class:{active:"ALIPAY"===t.payType},on:{click:function(e){t.payChange("支付宝")}}},[t._v("支付宝充值\n                  ")]),t._v(" "),s("button",{ref:"wxpay",staticClass:"payway weixin",class:{active:"WXPAY"===t.payType},on:{click:function(e){t.payChange("微信")}}},[t._v("微信充值\n                  ")])])])])]),t._v(" "),s("div",{staticClass:"pay-img-box"},[s("div",{staticClass:"payImg"},[t.codeSrc?s("img",{attrs:{src:t.codeSrc,alt:"付款二维码"}}):t._e()]),t._v(" "),s("p",{staticClass:"pay-des"},[t._v("\n              "+t._s(t.payway)+"扫一扫支付\n            ")])])])])]):t._e(),t._v(" "),t.successMoneyShow?s("message-box",{staticClass:"paid-money-msg",attrs:{width:"464px",type:"prompt",header:t.dialogTitle,header:""},on:{handleClick:t.finishMoney}},[s("div",{staticClass:"message-box-content"},[s("div",{staticClass:"success-img"},[s("img",{attrs:{src:a(588),alt:""}})]),t._v(" "),s("p",{staticClass:"paid-success-text"},[t._v("充值成功")]),t._v(" "),s("div",{staticClass:"paid-balance"},[t._v("当前账户余额 ¥"+t._s(t.billInfo.balance))])])]):t._e()],1)])},[],!1,null,"30ec5c48",null);C.options.__file="asset-list.vue";e.default=C.exports},717:function(t,e,a){},928:function(t,e,a){t.exports=a.p+"static/img/zhichu@2x.43655eb.png"},929:function(t,e,a){t.exports=a.p+"static/img/qianbao@2x.0fbed5c.png"},930:function(t,e,a){"use strict";var s=a(717);a.n(s).a}}]);