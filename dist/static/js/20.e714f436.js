(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{289:function(t,s,e){},440:function(t,s,e){"use strict";var i=e(289);e.n(i).a},591:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{on:{mousedown:function(s){t.canPaas=!1}}},[t.createdSuccess?t._e():e("div",{staticClass:"edit-page live-mager"},[e("div",{staticClass:"edit-title"},[t.activityId?e("span",{staticClass:"title"},[t._v("编辑活动")]):e("span",{staticClass:"title"},[t._v("新建活动")])]),t._v(" "),t._m(0),t._v(" "),e("div",{staticClass:"content from-box"},[e("div",{staticClass:"from-row"},[t._m(1),t._v(" "),e("div",{staticClass:"from-content"},[e("com-input",{staticClass:"inp",class:{error:t.titleEmpty},attrs:{value:t.title,placeholder:"请输入直播标题","max-length":30},on:{"update:value":function(s){t.title=s},focus:function(s){t.titleEmpty=!1}}}),t._v(" "),t.titleEmpty?e("span",{staticClass:"error-tips"},[t._v("直播标题不能为空")]):t._e()],1)]),t._v(" "),e("div",{staticClass:"from-row"},[t._m(2),t._v(" "),e("div",{staticClass:"from-content",class:{error:t.dateEmpty}},[e("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间",editable:!1,"picker-options":t.pickerOptions,format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss","popper-class":"datePicker"},on:{focus:function(s){t.dateEmpty=!1}},model:{value:t.date,callback:function(s){t.date=s},expression:"date"}}),t._v(" "),e("span",{staticClass:"tips-time"},[t._v("直播有效期为直播时间后的48小时之内（或开始直播后的48小时之内）")]),t._v(" "),t.dateEmpty?e("span",{staticClass:"error-tips"},[t._v("请选择直播时间")]):t._e()],1)]),t._v(" "),e("div",{staticClass:"from-row"},[t._m(3),t._v(" "),e("div",{staticClass:"from-content"},[e("ve-upload",{attrs:{title:"图片支持jpg、png、bmp格式，建议比例16:9，大小不超过2M",accept:"png|jpg|jpeg|bmp",defaultImg:t.defaultImg,fileSize:2048,errorMsg:t.uploadImgErrorMsg},on:{error:t.uploadError,success:t.uploadImgSuccess}})],1)]),t._v(" "),e("div",{staticClass:"from-row"},[t._m(4),t._v(" "),e("div",{staticClass:"from-content"},[e("ol",{staticClass:"tag-list clearfix"},t._l(t.tagGroup,function(s){return e("li",[t._v(t._s(s))])})),t._v(" "),e("el-button",{staticClass:"add-tag",attrs:{round:""},on:{click:function(s){t.tagModal=!0,t.tagEmpty=!1}}},[t._v("+")]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.tagModal,expression:"tagModal"}],staticClass:"tag-modal"},[e("el-checkbox-group",{attrs:{size:"mini",max:6},model:{value:t.tagGroup,callback:function(s){t.tagGroup=s},expression:"tagGroup"}},t._l(t.tagList,function(s){return e("el-checkbox-button",{key:s,attrs:{label:s}},[t._v(t._s(s))])}))],1),t._v(" "),t.tagEmpty?e("span",{staticClass:"error-tips"},[t._v("请添加直播标签")]):t._e()],1)]),t._v(" "),e("div",{staticClass:"from-row"},[e("div",{staticClass:"from-title"},[t._v("直播介绍：")]),t._v(" "),e("div",{staticClass:"from-content editor-content",class:{error:t.outRange},staticStyle:{position:"relative"}},[e("ve-editer",{attrs:{height:"280"},model:{value:t.editorContent,callback:function(s){t.editorContent=s},expression:"editorContent"}}),t._v(" "),e("span",{staticClass:"content-count"},[e("i",{staticClass:"count"},[t._v(t._s(t.countCount))]),t._v("/1000")]),t._v(" "),t.outRange?e("span",{staticClass:"error-tips"},[t._v("直播简介不能超过1000个字符")]):t._e()],1)]),t._v(" "),"PREPARE"!==t.status&&t.activityId?t._e():e("div",{staticClass:"from-row"},[e("div",{staticClass:"from-title"}),t._v(" "),e("div",{staticClass:"from-content"},[e("button",{staticClass:"create-btn",attrs:{disabled:t.outRange},on:{click:t.comfirm}},[t.activityId?[t._v("保存")]:[t._v("创建")]],2)])])])]),t._v(" "),e("transition",{attrs:{name:"fade"}},[t.createdSuccess?e("div",{staticClass:"finish-box"},[e("dl",[e("dt"),t._v(" "),e("dd",[t._v("直播已"+t._s(t.successTxt)+"，您可以")]),t._v(" "),e("dd",[e("span",{staticClass:"finish-button detail",on:{click:t.toDetail}},[t._v("活动详情")]),t._v(" "),e("span",{staticClass:"finish-button list",on:{click:t.toList}},[t._v("活动列表")])])])]):t._e()])],1)};i._withStripped=!0;var a=e(235),n=e(242),o=e(233),c={name:"edit",data:function(){return{tagModal:!1,isNew:!0,date:"",title:"",editorContent:"",outRange:!1,titleEmpty:!1,tagEmpty:!1,dateEmpty:!1,status:"",countCount:0,tagList:[],tagGroup:[],poster:"",uploadImgErrorMsg:"",percentImg:0,createdSuccess:!1,maxLength:1e3,activityId:this.$route.params.id,imgHost:"//test-zhike.oss-cn-beijing.aliyuncs.com/",pickerOptions:{disabledDate:function(t){return t.getTime()<Date.now()-864e5}},successTxt:"",canPaas:!0}},created:function(){this.tagList=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],this.activityId&&(this.isNew=!1,this.queryInfo())},watch:{editorContent:function(t,s){var e=this;this.$nextTick(function(){e.countCount=document.querySelector(".vue-html5-editor .content").innerText.gbLength(),e.countCount>e.maxLength?(e.outRange=!0,e.editorContent=t.substring(0,t.gbIndex(e.maxLength)+1),document.getElementsByClassName("content")[1].selectStart=5):e.outRange=!1})}},methods:{uploadImgSuccess:function(t){this.poster=t.name},uploadError:function(t){console.log("上传失败:",t),this.uploadImgErrorMsg=t.msg},uploadOver:function(t){console.log(t)},queryInfo:function(){var t=this;this.$get(o.a.GET_WEBINAR_INFO,{id:this.activityId}).then(function(s){t.date=s.data.startTime,t.title=s.data.title,t.poster=s.data.imgUrl,t.editorContent=s.data.description,t.tagGroup=s.data.tags,t.status=s.data.status})},comfirm:function(){var t=this,s={id:this.activityId,startTime:this.date,title:this.title,imgUrl:this.poster,description:this.editorContent,tags:this.tagGroup};this.title.length?this.titleEmpty=!1:this.titleEmpty=!0,this.tagGroup.length?this.tagEmpty=!1:this.tagEmpty=!0,this.date.length?this.dateEmpty=!1:this.dateEmpty=!0,this.$nextTick(function(){t.title.length&&t.tagGroup.length&&t.date.length&&t.updateWebinfo(t.isNew,s)})},updateWebinfo:function(t,s){var e=this;t?this.$config({handlers:[2001]}).$post(o.a.POST_CREATE_WEBINAR,s).then(function(t){e.createdSuccess=!0,e.canPaas=!0,e.successTxt="创建成功",t.data.id?e.finishId=t.data.id:e.finishId=e.activityId}).catch(function(t){2001===t.code&&e.$messageBox({header:"提示",content:"直播时间已过期，请重新选择!",autoClose:10,confirmText:"知道了"})}):this.$config({handlers:[2001]}).$post(o.a.POST_UPDATE_WEBINAR,s).then(function(t){e.createdSuccess=!0,e.canPaas=!0,e.successTxt="更新成功",t.data.id?e.finishId=t.data.id:e.finishId=e.activityId}).catch(function(t){2001===t.code&&e.$messageBox({header:"提示",content:"直播时间已过期，请重新选择!",autoClose:10,confirmText:"知道了"})})},toDetail:function(){this.canPaas=!0,this.$router.push({path:"/liveMager/detail/"+this.finishId})},toList:function(){this.canPaas=!0,this.$router.push({path:"/liveMager/list"})}},beforeRouteLeave:function(t,s,e){if(this.canPaas)return e(!0),!1;this.$messageBox({header:"提示",width:"400px",content:"是否放弃当前编辑？",cancelText:"否",confirmText:"是",handleClick:function(t){"confirm"===t.action?e(!0):e(!1)}})},computed:{defaultImg:function(){return this.poster?this.$imgHost+"/"+this.poster:""}},components:{VeEditer:n.a,VeUpload:a.a}},r=(e(440),e(1)),l=Object(r.a)(c,i,[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tips"},[s("i"),this._v("注意：活动在直播有效期内可发起直播，过期后将无法发起直播\n    ")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"from-title"},[s("i",{staticClass:"star"},[this._v("*")]),this._v("直播标题：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"from-title"},[s("i",{staticClass:"star"},[this._v("*")]),this._v("直播时间：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"from-title"},[s("i",{staticClass:"star"}),this._v("直播封面：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"from-title"},[s("i",{staticClass:"star"},[this._v("*")]),this._v("直播标签：")])}],!1,null,"a23341b4",null);l.options.__file="src/pages/live-mager/edit.vue";s.default=l.exports}}]);
//# sourceMappingURL=20.e714f436.js.map